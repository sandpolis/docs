<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Server - Sandpolis Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Server";
    var mkdocs_page_input_path = "application/server.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Sandpolis Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/getting_started.html">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/client/gui.html">Using the desktop client</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/client/terminal.html">Using the terminal client</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Specification</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/instance.html">Instance</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/agent.html">Agent</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/server.html">Server</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/clientserver.html">Client/Server</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../specification/serveragent.html">Server/Agent</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Plugins</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../specification/plugins/device.html">Device Plugin</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../specification/plugins/filesystem.html">Filesystem Plugin</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../specification/plugins/snapshot.html">Snapshot Plugin</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Implementation Reference</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="client.html">Client</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="server.html">Server</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="network.html">Networking</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Sandpolis Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Implementation Reference &raquo;</li>
        
      
    
    <li>Server</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h2 id="server-port">Server Port</h2>
<p>The official port for the Sandpolis server is <strong>8768</strong>.</p>
<h2 id="geolocation-services">Geolocation Services</h2>
<p>Sandpolis is able to get its location information from several sources, but the server can only use one service at a time. To choose a service, set the following system properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>server.geolocation.service</code></td>
<td><em>ip-api.com</em></td>
<td>The name of the geolocation service to use. Valid values are found in the table below.</td>
</tr>
<tr>
<td><code>server.geolocation.key</code></td>
<td><em>null</em></td>
<td>The service API key</td>
</tr>
<tr>
<td><code>server.geolocation.expiration</code></td>
<td><em>240</em></td>
<td>The cache timeout in hours</td>
</tr>
</tbody>
</table>
<p>The following public geolocation services are supported:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Identifier</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://ip-api.com" target="_blank">ip-api.com</a></td>
<td><code>ip-api.com</code></td>
</tr>
<tr>
<td><a href="https://tools.keycdn.com/geo" target="_blank">tools.keycdn.com</a></td>
<td><code>keycdn.com</code></td>
</tr>
</tbody>
</table>
<h2 id="permissions">Permissions</h2>
<p>Since multiple clients can connect to a particular server at the same time, it's nice to have a permissions system to restrict a user's power. In most cases, a single admin client is sufficient for managing Sandpolis. Some advanced use cases require multiple users, which are feasible thanks to the permissions system. </p>
<p>The user permissions system is similar to the MySQL permissions system. Permissions are "granted" to users by the admin upon user creation. These permissions dictate what a user can do on the server. New users have no permissions by default and therefore can do essentially nothing on the server.</p>
<h4 id="permissions-list">Permissions list</h4>
<table>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>server.generate</code></td>
<td>Rights to use the generator</td>
</tr>
<tr>
<td><code>server.fs.read</code></td>
<td>Read access to the server's filesystem</td>
</tr>
<tr>
<td><code>server.fs.write</code></td>
<td>Write access to the server's filesystem</td>
</tr>
<tr>
<td><code>server.users.view</code></td>
<td>Right to view usernames and permissions of all other users</td>
</tr>
<tr>
<td><code>server.users.create</code></td>
<td>Right to create new users (of lesser or equal permissions)</td>
</tr>
<tr>
<td><code>server.state.stop</code></td>
<td>Right to stop the server</td>
</tr>
<tr>
<td><code>server.state.shutdown</code></td>
<td>Right to shutdown the server</td>
</tr>
<tr>
<td><code>server.state.restart</code></td>
<td>Right to restart the server</td>
</tr>
<tr>
<td><code>server.net.view</code></td>
<td>Right to open the network control panel</td>
</tr>
<tr>
<td><code>server.net.create_listener</code></td>
<td>Right to create a new listener on the server</td>
</tr>
<tr>
<td><code>server.auth.create_group</code></td>
<td>Right to create a new authentication group on the server</td>
</tr>
<tr>
<td><code>client.fs.read</code></td>
<td>Read access to the client's filesystem</td>
</tr>
<tr>
<td><code>client.fs.write</code></td>
<td>Write access to the client's filesystem</td>
</tr>
<tr>
<td><code>client.state.shutdown</code></td>
<td>Right to shutdown the client</td>
</tr>
<tr>
<td><code>client.state.restart</code></td>
<td>Right to restart the client</td>
</tr>
</tbody>
</table>
<h2 id="authentication-groups">Authentication Groups</h2>
<p>Authentication groups solve two problems:</p>
<ul>
<li>they ensure clients connect to the correct server</li>
<li>they conveniently partition clients so permissions can be easily enforced</li>
</ul>
<p>Since clients are dynamic, enforcing <code>client.*</code> permissions is more complicated than enforcing <code>server.*</code> permissions. This is because the subject of a <code>client.*</code> permission varies with context while a <code>server.*</code> permission always refers to the only server in the network.  </p>
<h2 id="generators">Generators</h2>
<p>Sandpolis is compatible with many different platforms and therefore needs to have a flexible approach to client installation. A <code>Generator</code> is a routine which produces some installation artifact according to a supplied configuration (<code>GenConfig</code>). This installation artifact is then used to install the Sandpolis client on a remote system.</p>
<h3 id="installation-artifacts">Installation Artifacts</h3>
<p>At minimum, installation artifacts contain configuration and settings for the client. Usually, installation artifacts will also contain the actual client code and be runnable on the remote system.</p>
<h4 id="installers">Installers</h4>
<p>An installer contains the full client codebase and is runnable on the remote system. Upon execution, the installer sets up the base directory according to its configuration and executes the client. If the target directory already contains an installation, the old installation is overwritten.  In an automated upgrade scenario, this operation poses no risk to data stored in the old client's database because this data would have been already flushed to the server. A manual upgrade could destroy data cached in the client database and is therefore not recommended.</p>
<h5 id="advantages">Advantages</h5>
<ul>
<li>Simple</li>
<li>Does not require Internet access during installation</li>
</ul>
<h5 id="disadvantages">Disadvantages</h5>
<ul>
<li>File size is large</li>
<li>File transfer may be inconvenient</li>
</ul>
<h5 id="examples">Examples</h5>
<ul>
<li>Runnable Jar files (.jar, .war, .ear)</li>
<li>Windows portable executables (.exe, .msi)</li>
<li>Scripts (.sh, .rb, .py, .bat, ...)</li>
</ul>
<h4 id="downloaders">Downloaders</h4>
<p>Downloaders are similar to installers except dependencies must be downloaded upon execution. This can drastically reduce the size of the resulting installation artifact. Remote dependencies must be located in a Maven repository and not downloaded from the Sandpolis server.</p>
<h5 id="advantages_1">Advantages</h5>
<ul>
<li>Smaller file size</li>
</ul>
<h5 id="disadvantages_1">Disadvantages</h5>
<ul>
<li>Requires Internet access during installation</li>
<li>File transfer may be inconvenient</li>
</ul>
<h5 id="examples_1">Examples</h5>
<ul>
<li>Runnable Jar files (.jar, .war, .ear)</li>
<li>Windows portable executables (.exe, .msi)</li>
<li>Scripts (.sh, .rb, .py, .bat, ...)</li>
</ul>
<h4 id="tokens">Tokens</h4>
<p>A token is an artifact which only contains the client configuration and cannot be executed by itself. When provided to a generic installer, the token allows the client to be installed on the remote system.</p>
<h5 id="advantages_2">Advantages</h5>
<ul>
<li>No files are transferred</li>
</ul>
<h5 id="disadvantages_2">Disadvantages</h5>
<ul>
<li>More user interaction is required</li>
</ul>
<h5 id="examples_2">Examples</h5>
<ul>
<li>Barcodes for use on Android, IOS, etc...</li>
</ul>
<h3 id="generators_1">Generators</h3>
<p>All installation artifacts are first generated on the server using a generator and then transferred to the requesting client (or client in the case of an automated upgrade). </p>
<h5 id="generator-queue">Generator Queue</h5>
<p>Since performing a generation is an infrequent task, the server maintains a simple queue of requests (generation configs) and fufills them serially. If the queue becomes full, incoming requests are dropped.</p>
<h5 id="generator-configs">Generator Configs</h5>
<p>A <code>GenConfig</code> specifies what type of generator should process it, any necessary options for that generator, and where to direct the resulting installation artifact. <code>GenConfigs</code> are implicitly created on the client from the graphical interface.</p>
<h2 id="2-server">2 Server</h2>
<p>Server installations are entirely contained in a single directory called the base directory. This base directory may not coincide with the base directory of an agent or client installation.</p>
<h6 id="21-filesystem-structure">2.1 Filesystem Structure</h6>
<ul>
<li><code>/base/server.jar</code> The server executable.</li>
<li><code>/base/server.db</code> The server's only database.</li>
<li><code>/base/lib</code> A directory for extracted libraries, regardless of instance prerequisites.<ul>
<li><code>jar</code> Contains platform-independent Java libraries.</li>
<li><code>win</code> Contains Windows-specific native libraries.</li>
<li><code>lin</code> Contains Linux-specific native libraries.</li>
<li><code>osx</code> Contains OSX-specific native libraries.</li>
<li><code>bsd</code> Contains BSD-specific native libraries.</li>
<li><code>sol</code> Contains Solaris-specific native libraries.</li>
</ul>
</li>
<li><code>/base/tmp</code> A secondary temporary directory.</li>
</ul>
<h6 id="22-additional-changes">2.2 Additional Changes</h6>
<p>The server-installer makes additional platform specific changes upon installation:</p>
<h6 id="221-windows">2.2.1 Windows</h6>
<p>TODO: Research services</p>
<h6 id="222-linux">2.2.2 Linux</h6>
<h6 id="2221-systemd">2.2.2.1 Systemd</h6>
<p>Management via systemd is supported.</p>
<h6 id="223-mac-os">2.2.3 Mac OS</h6>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="agent.html" class="btn btn-neutral float-right" title="Agent">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="client.html" class="btn btn-neutral" title="Client"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="client.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="agent.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
